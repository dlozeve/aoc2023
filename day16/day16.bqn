grid←>•FLines"input"

Sim←{
  Step←{𝕊v‿nv:
    nexts←{∧´(0⊸≤∧<⟜(≢grid))⊑𝕩}¨⊸/∾{𝕊p‿d:
      {
	𝕊'.'‿·: ⟨⟨p+d,d⟩⟩ ;
	𝕊'/'‿·: ⟨⟨p-⌽d,-⌽d⟩⟩ ;
	𝕊'\'‿·: ⟨⟨p+⌽d,⌽d⟩⟩ ;
	𝕊'|'‿1: ⟨⟨p+d,d⟩⟩ ;
	𝕊'|'‿0: ⟨⟨p+1‿0,1‿0⟩,⟨p-1‿0,-1‿0⟩⟩ ;
	𝕊'-'‿0: ⟨⟨p+d,d⟩⟩ ;
	𝕊'-'‿1: ⟨⟨p+0‿1,0‿1⟩,⟨p-0‿1,-0‿1⟩⟩
      }⟨p⊑grid,|⊑d⟩
    }¨nv
    ⟨nv∾v,(¬nexts∊v)/nexts⟩
  }
  ⊑Step•_while_{0≠≠1⊑𝕩} ⟨⟩‿⟨𝕩⟩
}

•Show ≠⍷⊑¨Sim⟨0‿0,0‿1⟩

# v←Sim⟨0‿0,0‿1⟩
# •Out ⥊∾⟜(@+10)˘'█'˙¨⌾((⊑¨v)⊸⊑) (≢grid)⥊' '

m‿n←≢grid
starts←(⋈⟜1‿0¨0⊸∾¨↕m)∾(⋈⟜¯1‿0¨(m-1)⊸∾¨↕m)∾(⋈⟜0‿1¨∾⟜0¨↕n)∾(⋈⟜¯1‿0¨∾⟜(n-1)¨↕n)
•Show ⌈´≠¨⍷¨⊑¨¨Sim¨starts
